Multi-mode Sampling Period Selection for Embedded Real Time Control
Rajorshee Raha, Soumyajit Dey, Partha Pratim Chakrabarti, Pallab Dasgupta Department of Computer Science & Engineering Indian Institute of Technology Kharagpur, INDIA {rajorshee.raha, soumya, ppchak, pallab}@cse.iitkgp.ernet.in

arXiv:1506.08538v1 [cs.SY] 29 Jun 2015

ABSTRACT
Recent studies have shown that adaptively regulating the sampling rate results in significant reduction in computational resources in embedded software based control. Selecting a uniform sampling rate for a control loop is robust, but overtly pessimistic for sharing processors among multiple control loops. Fine grained regulation of periodicity achieves better resource utilization, but is hard to implement online in a robust way. In this paper we propose multi-mode sampling period selection, derived from an offline control theoretic analysis of the system. We report significant gains in computational efficiency without trading off control performance.

General Terms
Real Time Control, Automotive Software

Keywords
Real Time Control, Automotive Software

1.

INTRODUCTION

Embedded software-based control systems have traditionally been implemented by assuming fixed sampling rates and fixed task periods [3]. The sampling rate is derived from a control theoretic analysis [9] of the system in a manner that guarantees desired level of control performance at all reachable states of the system. A uniform period can be implemented robustly, since we can analyze the sampling rate of all the control tasks and then choose an appropriate computational infrastructure that can statically schedule a periodic execution of the software components of these control tasks. The schedule does not change during execution and hence the control performance is deterministic. Recent studies confirm a widely accepted belief, namely that a uniform sampling rate is not a good choice when multiple control loops share a common computing resource such as an Electronic control unit (ECU). These studies establish

Permission to make digital or hard copies of all or part of this work for personal or classroom use is granted without fee provided that copies are not made or distributed for profit or commercial advantage and that copies bear this notice and the full citation on the first page. To copy otherwise, to republish, to post on servers or to redistribute to lists, requires prior specific permission and/or a fee. Copyright 20XX ACM X-XXXXX-XX-X/XX/XX ...$15.00.

that the sampling period can be regulated to achieve significant benefits in computational performance without any trade off in control performance. In fact, it has also been shown that a non-uniform scheduling strategy can balance the sampling rates among the control loops sharing a ECU in such a way that the overall control performance improves [4, 5]. Uniform sampling rate is typically a pessimistic choice, since we need to choose a sampling rate that guarantees control performance at all reachable states of the system. It is often the case that the selected rate is necessary at only specific control states of the system, whereas at all other states a much lesser sampling rate suffices. Adaptive sampling derives its benefit from this fact by intelligently regulating the sampling period as needed to maintain the desired level of control performance [4]. Fine grained regulation of the sampling rate may theoretically determine the optimal balance between computational efficiency and control performance but such schemes are difficult to implement in practice due to non-determinism in timing introduced by the computational infrastructure (including message delays, execution time variations in different paths of the control software, etc). If the sampling rate is known a priori then it becomes possible to develop an appropriate schedule for all control tasks sharing a ECU with adequate consideration for these types of non-determinism. In this paper we profess the use of coarse grained regulation of the sampling rate. Specifically we propose an approach where for each control loop, a limited number of sampling rates are chosen and a control theoretic analysis is used to determine the switching criteria between these modes. Therefore, for each control loop we have a set of sampling states, and an automaton that captures the switching between these sampling states. The global sampling state of the system is a concatenation of the sampling states of the control loops in the system. For each global sampling state, the exact schedule for the control tasks is precomputed considering all types of non-determinism arising out of the execution of software tasks. The reachable global sampling states are chosen based on available computational bandwidth and the relative priorities of the control loops. The primary objective of this paper is to establish the benefit of using multiple discretely chosen sampling rates. In the process, we also present the following enabling contributions. 1. We outline the basis for choosing the various sampling rates based on use case analysis. 2. We present an analytical approach which determines

the criteria for switching between sampling rates so that control performance is not hampered. 3. We present the construction of an automaton based scheduler, which implements the switching between sampling rates of the controller. We present the necessary background for the work in Section 2. We outline the methodology of multi-mode sampling period selection in Section 3. Subsequently, we use the control theoretic model of an Anti-lock Braking System (ABS) as a running example to validate our approach.

3. METHODOLOGY OUTLINE
In this section, we outline our proposed methodology of multi-mode sampling period selection for embedded real time control. The main steps of this proposed multi-mode methodology are as follows, · Step I : Developing a control theoretic model of the corresponding system. · Step II : Classification of different modes based on different control parameters and selection of best possible sampling rate for the corresponding operating modes. · Step III : Construction of a supervisory automaton for controlling the mode switching.

2.

BACKGROUND STUDY

In this section, we outline the mathematical relation between the sampling period of a discrete time controller and its control stability. Any discrete time feedback control system can be represented as shown in Fig. 1 [2], here x(t) is the input to the system, e(t) is the error signal, u(t) is the controller output and y (t) is the plant output fed back to the controller using a sensor.

Figure 2: Methodology Outline In the following sections we demonstrate the proposed methodology with an extensive analysis of ABS as a running example. In Section 4, we present the control model of the ABS. In Section 5, we divide the driving pattern of a vehicle into multiple modes parameterized by vehicular characteristics like velocity, brake pedal pressure and slip. For each such mode, we choose a sampling frequency which ensures stability guarantee of the ABS. In Section 6, we outline our approach for guard condition selection for switching between different modes, and synthesize a scheduler automaton which may supervise the mode selection depending on vehicular dynamics. In Section 7, we provide experimental results supporting the proposed approach.

Figure 1: Discrete Time Control System Generally, the sampling of the continuous signal is done at a constant rate T , which is known as the sampling period or interval. The sampled signal ek = e(kT ), is the discretized signal with k  N. In general, for any transfer function, the control signal output depends on n previous control signal output instances and m previous error signal instances [2]. The situation may be represented as, uk = -a1 uk-1 - a2 uk-2 - · · · - an uk-n + b0 ek + (1) b 1 e k -1 + b 2 e k -2 + · · · + b m e k -m The discrete signals uk-1 ,uk-2 , .. are the delayed versions of uk by sampling period T, 2T, .. respectively. In Laplace domain, a time delay is introduced into a signal by multiplying its Laplace transform by the operator e-T s . Let the Laplace domain representation of uk and ek be U (s) and E (s) respectively [7]. Hence, uk-1 , uk-2 , .. can be represented in Laplace frequency domain as e-T s U (s), e-2T s U (s) , .. respectively and similarly for ek-1 , .. . Thus, the corresponding Laplace domain representation of Eq. 1 shall be, U (s) = -a1 e-T s U (s) - a2 e-2T s U (s) - · · · + b0 E (s)+ b1 e-T s E (s) + b2 e-2T s E (s) + . . . (2)

4. CONTROL MODEL
ABS is an automobile safety critical driver assistance system which prevents the wheels from locking and avoids uncontrolled skidding. An abstract block diagram of a vehicle with ABS is shown in Fig. 5. For designing the vehicle we used a simplified quarter car model as shown in Fig. 3. Here, m is the mass of the quarter vehicle, Vx is lateral speed of the vehicle,  is the angular speed of the wheel, FN is the vehicle vertical force, Fx is the frictional force transmitted to the road, Mb is the braking torque, R is the wheel radius and J is the wheel inertia. Wheel slip  is given as,  = 1 - R/Vx . The effective braking force is dependent on the frictional force [1] transmitted to the road which is related to FN as, Fx = -µFN , where µ is the frictional coefficient of the road

Substituting eT s with the discrete frequency domain operator z [2] and simplifying this further we get the discrete time transfer function of the controller C (z ) as, m b0 z n + b1 z n-1 + .. + bm z n-m j =1 (z - zj ) n-m = b z (3) 0 z n + a1 z n-1 + .. + an n i=1 (z - pi ) where zj are the zeros and pi are the poles of the transfer function. Behavior of any discrete time controller can be observed by analyzing the poles and zeros of the corresponding transfer function [2]. The positions of the poles and zeros differ for different sampling intervals (T ). Correspondingly, the control stability of the overall system gets effected. More related background is provided in Appendix A.

Figure 3: 1/4 Car Forces and Torques [1]

1

Frictional Co-efficient

design a discrete PID controller for this purpose as, de dt Ki T Kd (z - 1) Mb (z ) = [Kp + + ]E (z ) z-1 T Mb = Kp e + Ki edt + Kd
1

0.8 0.6 0.4 0.2 0 0 Dry Aspalt Gravel Loose Gravel Wet 0.2 0.4 0.6 0.8

(7)

Slip

Figure 4: µ -  Curve [10]

Here Kp , Ki , Kd are the proportional, integral, and derivative gain respectively of the PID controller. T is the sampling interval. Mb (z ), E (z ) are the discrete domain representation of the the braking torque, Mb and the error signal, e = d - , which is the difference between the desired slip (d ) and actual slip (). Observe that when  = d then  = 0. Substituting this in Eq. 5, Mb can be e = 0, i.e.  represented as, J Mb = [( - 1) - mR]Vx (8) R Hence, it is obvious from Eq. 7 & 8 that the control performance, i.e. stability of the ABS controller will vary for different values of T , Vx and .

Figure 5: ABS Overview [1]

surface. Thus, as evident from Fig. 4, the amount of slip will vary depending on road conditions. Relationship between wheel slip and frictional coefficient can be approximated, µ = f (), using a piecewise linear function [6] as, µ= , 1 -2 +   0.2  > 0.2 (4)

5. MODE AND PERIOD SELECTION
The candidate sampling modes and periods for a controller are determined by partitioning its input space based on the use-case scenarios and stability of the control law in those scenarios. For example, in ABS, the adequacy of a sampling rate in a given scenario depends on the urgency of braking (which is a function of vehicle speed and pedal pressure) and the slip ratio (which is a function of the vehicle speed and friction on the road). In general, we select the different possible sampling frequencies of the controller using the following approach. 1. Identify vehicular parameters which impact the controller output (i.e. braking torque in this case). 2. Identify multiple possible driving scenarios and corresponding ranges of vehicular parameters and also the probable driver response. 3. Perform stability analysis followed by identification of maximal acceptable sampling period in each driving scenario. Steps 2 and 3 may have to be iterated to arrive at a gainful combination of sampling modes. A sampling mode is effective towards gaining computational efficiency only if the controller stays in that mode for a non-trivial period of time. Therefore it is necessary to relate the sampling modes with different use-case scenarios. In ABS, we estimate different possible traffic scenarios (city traffic, suburban or medium traffic & highway traffic) and the variation in traffic density, traffic regulations and corresponding average cruising speed and driver reaction to arrive at the sampling modes. We categorize the brake pedal pressure range as low, mild, medium and high, and also consider various speed ranges and slip ratios. For each of the scenarios, we determine the sampling rate at which the controller is stable. Through this study we selected three sampling modes, as outlined below: · N0 Mode: This mode requires the least sampling rate among the three chosen mode, and targets scenarios where the vehicle is cruising at low to medium speeds (such as in city traffic). Considering average cruising speed and the driver reaction, we arrive at the operating sampling rate

3 4

+ ,

where,   [0, 8] and   [-0.1, 0.1]. The non-linear equations for designing a quarter car model can be given as,
1 Vx = - m FN µ R b   = J FN µ - M J 2  = - 1 [ 1 (1 - ) + R ]FN µ +  Vx m J

(5)
1 R Vx J

Mb

Using Taylor series expansion method [6, 8] for linearizing a nonlinear system we obtain a linear (affine) system description from Eq. 5 as, x  = Al x + El + Bl u y = Cl x + Dl u (6)

where, xT = [Vx , ], u = Mb · Vx , y = [], Al , Bl , Cl , Dl are system input and output matrices respectively. El , l = f (x) are the affine term and function telling the validation of linearizion. The formation of this state space equation from the nonlinear equations are described in details in Appendix B. The objective of ABS controller is to decelerate the vehicle as fast as possible, while maintaining its steer ability by minimizing wheel slip. The main components of ABS are the ABS-ECU, hydraulic modulator, and wheel speed sensor. The ECU constantly monitors the wheel rotational speed through the wheel speed sensors, and also measures the actual slip. The controller's task is to maintain the braking torque within a certain range. The braking force is applied to the wheels by the hydraulic modulator. It rapidly pulses the brakes to prevent wheel lock up, even during panic braking in extreme conditions and promises shortest possible distance under most conditions. We can

Ts = 0.2ms in which the ABS achieves satisfactory control performance as given by Fig. 6. For a given velocity (X axis) and slip (Y axis), we carry out the standard unit circle analysis and plot the maximum magnitude among the different pole positions (Z axis) of the transfer function corresponding to Ts = 0.2ms. The stability variation for different slip values is due to the piecewise linear function given in Eq. 4. It may be observed from Fig. 6, all the poles are of magnitude <= 1 for velocity range [0 . . . 85]km/h and slip range [0 . . . 0.65] thus ensuring stable vehicular dynamics. Thus correspondingly brake pedal pressure variation range is selected as [low, mild, medium] estimating the probability of the above mentioned slip range. We carry out similar analysis for the other cruising modes and derive satisfactory sampling intervals.

Unstable
2

2.5

|Pole|

1.5 1 0.5 0 1 0.8 0.6 200 0.4 0.2 150 100 0 50 0 250

Stable

Slip

Velocity (km/h)

Stable

Figure 8: E Mode Stability Guarantee

6. SUPERVISORY AUTOMATA
Our analysis of the different possible driving scenarios and the choice of sampling periods entails the creation of a scheduler which may dynamically switch the controller among different sampling modes. Such a supervisory automaton is shown in Fig. 9. The criteria for switching between the three

Unstable
2

2.5

|Pole|

1.5 1 0.5 0 1 0.8 0.6 100 120 140

Stable Slip

Figure 9: Scheduler Automata
0.4 0.2 0 0 20 40 60 80

Velocity(km/h)

Stable

Figure 6: N0 Mode Stability Guarantee · N1 Mode: This mode uses higher sampling rate than N0, and targets suburban traffic scenarios. The maximum sampling interval with stability guarantee is found to be Ts = 0.15ms as shown in Fig. 7.

modes of the automaton is chosen based on our observations about vehicular parameters vis-a-vis stability. Let "v " and "bpp" be the velocity and brake pedal pressure respectively. The brake pedal pressure is divided in to the ranges low, mild, medium and high. High brake pedal pressure represents the probability of larger value of slip. Medium, mild and low brake pedal pressure signifies lesser value of slip. The guard conditions for switching between states are given as,
n0 = = = (v  [0 . . . 85] & bpp  [low, mild, medium]) | (v  [85 . . . 140] & bpp  [low, mild]) (v  [0 . . . 80] & bpp  [low, mild, medium]) | (v  80 . . . 135] & bpp  [low, mild]) (v  [0 . . . 85] & bpp  [high]) | (v  [85 . . . 140] & bpp  [medium, high]) | (v  [> 140] & bpp  [low, mild]) (v  [0 . . . 80] & bpp  [high]) | (v  [80 . . . 135] & bpp  [medium, high]) | (v  [> 135] & bpp  [low, mild]) e = (v  [> 140] & bpp  [medium, high])

2.5

Unstable
2

 n 0

|Pole|

1.5 1 0.5

n1

Stable
0 1 0.8 0.6 140 160 180 120

Slip

0.4 0.2 0 0 20 40 60

80

100

 n 1

=

Velocity(km/h)

Stable

Figure 7: N1 Mode Stability Guarantee · E Mode: This mode uses a sampling rate that is adequate in all scenarios. Existing approaches for choosing a uniform sampling mode will choose this sampling rate. We choose the sampling frequency for which the vehicle remains stable considering all velocity and brake pedal pressure variations as shown in Fig. 8. The corresponding sampling period for our model is found to be Ts = 0.1ms. We designate this as emergency sampling mode, in case of any driving irregularity the controller switches to this mode, thus ensuring vehicular stability. Z-domain unit circle stability analysis is used to show the vehicular parameters and stability relationship graphically for extensive parameter ranges. Similar observations can be obtained mathematically using other nonlinear system stability [2] criteria like, Lyapunov, Nyquist, Routh-Hurwitz or Bode plot analysis. The effective braking pressure range is varied in each of these modes to achieve satisfactory performance, depending upon driving scenarios. The mode switching and detailed switching criterion are discussed in the next section.

The guard conditions for switching between `N 0' to `N 1'  and vice versa are selected to be `n1 ' and `n 0 ' respectively. Similarly, for `N 1' to `E ' and vice versa, switching condi tions are `e ' and `n 1 ' respectively. The guard conditions are selected ensuring some amount of hysteresis while mode switching. For example, the automaton switches from mode `N 0' to mode `N 1' in case bpp = high and v  [0 . . . 85]. However, the automaton switches from mode `N 1' to mode `N 0' when v  [0 . . . 80] and bpp is not high. Similarly, the automaton switches from mode "N 1" to E when bpp is medium or high and v  [> 140], however, the automaton switches from mode `E ' to mode `N 1' when v  [> 135] and bpp is low or mild. Whenever the automaton makes a transition from a mode with lower sampling period to a mode with higher sampling period (e.g. E to N 1), it ensures that the guard conditions are valid for a certain prefixed number of clock cycles. In that way, unwanted glitches due to faulty sensor readings are expected to be filtered out.

Magnitude (dB)

The main objective of synthesizing the scheduler automaton was to reduce ECU bandwidth requirement. Scheduling in E mode signifies a sampling periodicity of 0.1ms, while the sampling periodicity of N 0 and N 1 modes are 0.2ms and 0.15ms respectively. If we notice the mode switching scenarios, we observe that when the car is cruising at a certain speed and no brake pedal pressure is applied, the controller is scheduled using infrequent sampling periods (N 0 or N 1). Further, in scenarios when the car is cruising at a certain speed and brake pedal pressure is applied, the mode switching will be supervised by the respective scheduler automaton ensuring that it will switch to a more frequent sampling mode. Thereby, in a general cruising scenario, a multi-mode controller ensures nearly 30% - 50% ECU bandwidth saving as shown in our simulation results.

the stability of the system. We empirically observe the variation of stability with sampling rate. For stability analysis, we used unit circle as well as bode plot analysis [2]. We take a moderate velocity, say V = 60km/h and calculate the stability of the system for different sampling intervals. We show one such example Bode plot for stability analysis in Fig. 11. It may be observed that with the sampling interval Ts = 0.01s, the system is unstable. However, if we drastically reduce the sampling interval to 0.1ms, the system becomes stable. In Appendix C.1 and C.2 more such results are given.
Bode Diagram 1 0 -1 -2 -3 10 0.1ms 0.01s

7.

RESULTS

The initial part of this section is devoted towards establishing the motivation for multi-mode sampling through experimental results. The latter part of the section demonstrates the gain in computational bandwidth and the benefit of effective sharing of computational resources between multiple controllers. We analyze the performance of the ABS for different sampling intervals. Observing the µ vs  curve in Fig. 4 carefully, we notice that the peak point on most of the road scenarios belong to the range [0, 0.2]. Hence, for effective braking with maximum possible road friction, we set d = 0.2 as the desired slip. In our experimental setup, when brake force is applied with current velocity V = 100km/h, it is expected to gradually decrease until V = 0km/h and throughout this deceleration phase the slip value should be as close as possible to the desired slip (d =0.2) thus ensuring smooth braking. Finally the slip value should be 1 (normalized slip) when the vehicle comes to rest.
100 90 80 70 60 Speed Speed 50 40 30 20 10 0 0 2 4 6 8 Time 10 12 14 16 18 Vehicle Speed Wheel Speed 100 90 80 70 60 50 40 30 20 10 0 0 2 4 6 8 Time 10 12 14 16 Vehicle Speed Wheel Speed

Phase (deg)

5 0 -5

System: 0.01s Phase Margin (deg): -180 Delay Margin (samples): Inf At frequency (rad/s): 0 Closed loop stable? No System: 0.1ms Phase Margin (deg): -180 Delay Margin (samples): 2.62 At frequency (rad/s): 1.2e+04 Closed loop stable? Yes 10
-2

-10 -3 10

10 10 Frequency (rad/s)

-1

0

10

1

10

2

Figure 11: Stability Variation:Ts = 0.01s, Unstable & Ts = 0.1ms, Stable We have employed our methodology of multi-mode sampling period selection for the ABS running example. We consider a braking scenario with the initial and final speed being 200km/h and 0km/h respectively and compare the minimum stopping distance achieved by our `Multi-mode' ABS Controller with the existing Matlab model of ABS with fixed periodicity. The simulation results are provided in Table 1 considering different possible road surfaces. We obTable 1: Stopping Distance in Kilometer
ABS Controller Existing model Multi-mode Dry Asphalt 3.073 3.080 Road Surface Gravel Loose Gravel 3.424 3.771 3.433 3.795 Wet 4.269 4.289

Slip 1 Normalized Relative Slip 0.8 0.6 0.4 0.2 0 Normalized Relative Slip 1 0.8 0.6 0.4 0.2 0

Slip

0

5

10 Time

15

20

0

2

4

6

8 Time

10

12

14

16

Figure 10: Slip Variation: the Left & Right column figures correspond to sampling time Ts1 = 1s & sampling time Ts1 = 0.01s respectively. We observe that the slip varies significantly for two different sampling rates as given by Fig. 10. Observe from the left column in Fig. 10 that with a choice of moderate sampling rate, the slip varies drastically thus leading to undesired perturbations in vehicular speed while braking. However, as shown in the right column of the same figure, with the higher sampling rate, the slip exhibits a well damped trajectory around the desired value (d =0.2) leading to smoother vehicular deceleration. Our notion of control performance is based on ensuring

serve that the stopping distance is nearly same for both the controllers. For this `panic braking' scenario, the estimated percentage of time spent in each of E , N 1 and N 0 modes is highlighted in Fig. 12. It is evident from Fig. 12 that we can save significant amount of ECU bandwidth (30% - 50%) using a multi-mode controller as compared to the controller with fixed periodicity.

100 90

B/W Requirement (%)

80 70 60 50 40 30 20 10 0 0
Multi-mode (Wet Road) Multi-mode (Loose Gravel Road) Multi-mode (Gravel Road) Multi-mode (Dry Road) Existing (All Road)

200

400

600

800

1000

Time (sec)

Figure 12: ECU, Panic Braking Scenario

Further, we investigate the utility of our multi-mode ABS controller in a general cruising scenario where the car is being driven in a speed range of 0km/h to 200km/h, in various traffic densities. The ECU bandwidth requirement for this scenario is shown in Fig. 13. It is evident that the multimode controller requires much lesser bandwidth compared to the existing controller since the supervisory automaton schedules the controller in the infrequent sampling modes for most of the time as described in Section 6. In that way, we can guarantee a significant amount of bandwidth saving which may be utilized for scheduling other tasks.
100

100

B/W Requirement (%)

80 60 40 20 0 0

ACC ABS

200

400

600 800 Time (sec)

1000

1200

Figure 15: ECU Sharing: ACC-ABS

8. CONCLUSIONS
The present work provides a methodology for adaptively regulating the sampling rate of embedded software based controllers leading to significant reduction of computational resource requirement. Applying the methodology on single controller based systems like ABS has shown that 30% - 50% reduction in ECU bandwidth requirement is possible. Further, it was also shown that the method smoothly scales up for multiple controller based systems. Our future research shall focus on giving a sound formal underpinning to the method of creating multiple sampling modes for software based controllers and creating a tool flow which mechanizes the synthesis of such multi-mode controllers.

B/W Requirement (%)

80

60

40

20

Multi-mode Existing
500 1000 1500 2000

0 0

Time (sec)

Figure 13: ECU, General Cruising Scenario We further demonstrate the promise of multi-mode sampling for a multiple ECU scenario taking an Adaptive Cruise Control (ACC) system as a running example. ACC is an automobile safety critical driver assistance system which automatically adjusts the vehicle speed in order to maintain a safe distance from vehicles ahead. In case of an ACC system, the driver sets a safe cruising speed and a desired safe distance (from preceding vehicle) as controller inputs. The other inputs of an ACC controller which comes from the radar sensor are preceding vehicle speed and approximate distance from preceding vehicle as shown in Fig. 14.

9. REFERENCES
[1] Safety, Comfort and Convenience Systems. Robert Bosch GmbH, 2006. [2] K. ° Astr¨ om and B. Wittenmark. Computer controlled systems: theory and design. Prentice Hall, 1984. [3] G. Buttazzo. Research trends in real-time computing for embedded systems. SIGBED Rev., 3(3). [4] A. Cervin, M. Velasco, P. Marti, and A. Camacho. Optimal online sampling period assignment: Theory and experiments. IEEE Transactions on Control Systems Technology, 19(4), 2011. [5] D. Henriksson and A. Cervin. Optimal on-line sampling period assignment for real-time control tasks based on plant state information. In 44th IEEE CDC-ECC, 2005. [6] H. Khalil. Nonlinear systems. Macmillan Pub.Co., 1992. [7] B. Kuo. Automatic control systems. Prentice Hall, 1962. [8] M. Schinkel and K. Hunt. Anti-lock braking control using a sliding mode like approach. In Proceedings of the ACC,, volume 3, 2002. [9] D. Seto, J. Lehoczky, L. Sha, and K. Shin. On task schedulability in real-time control systems. In 17th IEEE RTSS, 1996. [10] J. Wong. Theory of Ground Vehicles. Wiley, 2001.

Figure 14: ACC System Overview [1] ACC is a drive assist system for highway cruising which monitors the inputs and decides cruising speed or distance to lead vehicle. When the applied brake pedal pressure is high, the ACC is overridden by the braking controller (ABS). The operating modes of ACC controller can be classified into `active', `suspended' and `idle' while our multi-mode ABS operates in three different modes as discussed previously. Generally, the ACC system and the braking controller are mapped to separate ECUs. We can achieve significant reduction in bandwidth requirement by sharing an ECU between these features. When the ACC is suspended, because the applied brake pedal pressure is high, we schedule the ABS controller with frequent sampling rate and the ACC controller with relatively infrequent sampling rates. On the other hand, when the ACC is active, i.e. applied brake pedal pressure is low or null, then the ACC controller is scheduled with frequent sampling rate and the ABS controller is scheduled with relatively infrequent sampling rate. In Fig. 15, we show the bandwidth requirement of both ACC and ABS controllers when scheduled in a single ECU while providing satisfactory control performance.

APPENDIX A. BASIC CONTROL SYSTEM
Any continuous feedback control system[7] can be represented as shown in Fig. 16, where x(t) is the input to the system, e(t) is the error signal, u(t) is the controller output and y (t) is the plant output fed back to the controller using a sensor(H). Correspondingly, a Discrete time Feedback

A.1 Stability: Discrete Time Control System
The stability property of this system can be defined from the impulse response of a system as · Asymptotic stable system: The steady state impulse response is zero. lim y (k) = 0
k

· Marginally stable system: The steady state impulse response is different from zero, but limited. lim 0 < y (k) < 
k

· Unstable system: The steady state impulse response is unlimited. lim y (k) = 
k

Figure 16: Continuous Time Control System Control System can be represented as shown in Fig. 17, where the dotted box highlights the discretized controller [2]. Generally, the sampling of the continuous signal is done

where y (k) is the impulse response of the corresponding system. The impulse response for different stability property is illustrated in Fig. 18. Let us assume a control system with
Stable System
2 Magnitude 1.5 1 0.5 0 0 50 100 150 Time 200 250 300

Marginally Stable System
1 Magnitude 0.5 0 -0.5 -1 0 x 10
25

Figure 17: Discrete Time Control System at a constant rate T , which is known as the sampling period or interval. The sampled signal yk = y (kT ) is the discretized signal with k  N. For understanding the design of a discretized control system, let us first consider a simple continuous domain transfer function for the controller C in Fig. 16 given as follows. C (s ) =
du dt U (s) E (s)

50

100 Time

150

200

250

Unstable System

1 Magnitude

0

-1

=

K (s+a) (s+b)

0

50

100

150 TIme

200

250

300

The corresponding time domain representation shall be, + bu = K ( de + ae) dt The Euler's approximation of the first order derivative is represented as: dx xk+1 - xk  (9) dt t Applying Euler's approximation of first order derivative [2] on the continuous differential equation, we get the following discrete difference equation.
uk+1 -uk t

Figure 18: Impulse Response and Stability input u and output y . The transfer function of any discrete time control system can be represented as C (z ) =
y (z ) u (z )

=

bz ( z - p)

where p is the pole which is in general a complex number and can be written in polar from as p = mej where m is the magnitude and  is the phase. The impulse response of the system can be given as } = b|m|k ejk y (k) = Z -1 { zbz -p Thus, it is the magnitude m which determines if the steady state impulse response converges towards zero or not. The relationship between stability and pole placement can be stated as follows. · Asymptotic stable system: All poles lie inside (none is on) the unit circle, or what is the same: all poles have magnitude less than 1. · Marginally stable system: One or more poles but no multiple poles are on the unit circle. · Unstable system: At least one pole is outside the unit circle. The situation is graphically shown in Fig. 19.

+ buk = K (

ek+1 -ek t

+ aek )

Generally, t, K, a and b are fixed. The digital controller updates the control signal every cycle as per the following equation, uk+1 = -a1 uk + b0 ek+1 + b1 ek (10) where, b0 = K , b1 = K (at - 1), a1 = (bt - 1). In general, for any transfer function, the control signal output depends on n previous control signal output instances and m previous error signal instances which can be represented as[2], uk = -a1 uk-1 - a2 uk-2 - · · · - an uk-n + b0 ek + b 1 e k -1 + b 2 e k -2 + · · · + b m e k -m (11)

The discrete signals uk-1 ,uk-2 , . . . are the delayed versions of uk by sampling period T, 2T,. . . respectively.

wheel slip and frictional coefficient can be approximated by using piecewise linear function as, µ() = , -1 + 2
3 4

+ ,

  0.2  > 0.2

(12)

where,   [4.8, 5.1, 5.46, 6.4] and   [-0.1, 0.1]. Al = 0
2  NR   FV 2 x J N - F m F N R2  V  J x

(13)

Figure 19: Unit Circle: Stability areas in Complex Plane

El = and for  > 0.2 Al = 0

0
R2   - F N J Vx 

(14)

B.

QUARTER VEHICLE MODELING

A quarter car model is shown in figure 20. Here, m is the

FN R +3 ) FN R ± 0.1 V (-  2 J 2 4 V 2 J 
x x



2

2

FN 4m F N R2 J 4Vx 

(15)

El =

(

 2

3 N ± 0.1) F (- 4 m 2 F R2 3 NR ± 0 .2 F -2 ) VN J V  J 
x x

(16)

The stability analysis of this system can be done using Lyapunov, Bode, Nyquist, Unit Circle or Hurwitz stability criteria [8].

C.
Figure 20: 1/4 car forces and torques mass of the quarter vehicle, Vx is lateral speed of the vehicle,  is the angular speed of the wheel, FN is the vehicle vertical force, Fx is tire frictional force, Mb is the braking torque, R is the wheel radius and J is the wheel inertia. Wheel slip  is represented as: =1-
R Vx

STABILITY V/S SAMPLING PERIOD

In this section we provide few examples relating to the variation in stability with respect to sampling periods.

C.1 Simple Examples:
Let the transfer function of any arbitrary system be, U (s ) =
s+0.5 ms2 +bs+u

The relationship between FN and Fx [1] is given as: Fx = -µ()FN where µ() is the frictional coefficient of the road surface. The non-linear equations for designing a quarter car model can be given as[8]:
1 Vx = - m FN µ() R b   = J FN µ() - M J x (1-)-R V   = 

Case 1: Let m=2, b=-0.5, u=1. For Ts =2s the system unstable but for Ts =1s the system is stable. The values of m, b, u are same for both of the sampling intervals. The corresponding stability response is shown in Fig. 21.
Bode Diagram 10 5 0 -5 -10 -15 -135 Phase (deg)
System: Ts_1 Gain Margin (dB): 11.8 At frequency (rad/s): 3.14 Closed loop stable? Yes

 = 

1 -V [ 1 (1 x m

- ) +

Vx R2 ]FN µ() J

+

1 R Vx J

Mb

Magnitude (dB)

Ts_2 Ts_1

-180 -225 -270 -315 -360 -2 10
-1 0 1

For linearizing the system approximation using the Taylor  series expansion can be expressed as [6]: f (, Vx )  f ( , Vx ) d f d f    ( -  ) + + d | ,Vx |   (V - Vx ). From this from dV  ,Vx this we can derive a linear (affine) system description as: x  = Al x + El + Bl u y = Cl x + Dl u l = f (x ) where, Al , Bl , Cl , Dl are system input and output matrices respectively. El are the affine terms and f (x) is the function telling the validity of linearizion and xT = [Vx , ] , u = Mb · Vx , y = []. From Fig. 4 the relationship between

System: Ts_1 Phase Margin (deg): -132 Delay Margin (samples): 9.04 At frequency (rad/s): 0.44 Closed loop stable? Yes

System: Ts_2 Phase Margin (deg): -12.2 Delay Margin (samples): 3.12 At frequency (rad/s): 0.973 Closed loop stable? No

10

10 Frequency (rad/s)

10

Figure 21: Ts = 2s, Unstable; Ts = 1s, Stable Case 2: Let m=5, b=1, u=10. In this case the system stable for both the sampling intervals Ts =2s and Ts =1s. The values of m, b, u are same for both of the sampling intervals. The corresponding stability response is shown in Fig. 22.

Bode Diagram 0 -5 Magnitude (dB) -10 -15 -20 -25 -30 45 0 Phase (deg) -45 -90 -135 -180 -2 10
-1 0 1

Ts_2 Ts_1

System: Ts_2 Gain Margin (dB): 2.43 At frequency (rad/s): 1.57 Closed loop stable? Yes

Case 3: For V = 40 Km/h,  = 0.2, the stability response is shown in Fig. 25.
Bode Diagram 0.5

Magnitude (dB)

System: Ts_1 Gain Margin (dB): 18.3 At frequency (rad/s): 3.14 Closed loop stable? Yes

0 -0.5 -1 -1.5 5

10

10 Frequency (rad/s)

10

Phase (deg)

System: T_N Phase Margin (deg): -179 Delay Margin (samples): 9.58 At frequency (rad/s): 33.1 Closed loop stable? No

0
System: T_E Phase Margin (deg): -180 Delay Margin (samples): 6.72 At frequency (rad/s): 9.38e+03 Closed loop stable? Yes

Figure 22: Ts = 2s, and Ts = 1s, Both Stable

C.2

ABS example

-5 -2 10

10

-1

10 10 Frequency (rad/s)

0

1

10

2

10

3

We provide more examples of stabiliy variation with sampling interval for the ABS controller model. Case 1: For V = 10 Km/h,  = 0.1, the stability response is shown in Fig. 23.
Bode Diagram 0.2

Figure 25: Ts = 0.6 ms, Unstable; Ts = 0.3 ms, Stable Case 4: For V = 15 Km/h,  = 0.3, the stability response is shown in Fig. 26.
Bode Diagram 0.4 T_E T_N

Magnitude (dB)

0.1 0 -0.1 -0.2 -0.3 1 Magnitude (dB) 0.2 0 -0.2 -0.4 -0.6 2 Phase (deg)
System: T_N Phase Margin (deg): -180 Delay Margin (samples): Inf At frequency (rad/s): 0 Closed loop stable? Yes

Phase (deg)

0.5 0 -0.5

1 0 -1 -2 -2 10

System: T_N Phase Margin (deg): -179 Delay Margin (samples): 1.39 At frequency (rad/s): 2.27e+03 Closed loop stable? Yes

T_N -1 -2 10 10
-1

System: T_E Phase Margin (deg): -180 Delay Margin (samples): 2.43 At frequency (rad/s): 2.6e+03 Closed loop stable? Yes

10

0

10 Frequency (rad/s)

1

10

2

10

3

10

4

10

-1

10

0

10 Frequency (rad/s)

1

10

2

10

3

10

4

Figure 23: Ts = 0.6 ms, Stable Case 2: For V = 100 Km/h,  = 0.6, the stability response is shown in Fig. 24.
Bode Diagram 0 -200 -400 -600 -800 180 Phase (deg) 0 -180 -360 -540 -3 10
System: T_E Phase Margin (deg): -180 Delay Margin (samples): 3.34 At frequency (rad/s): 1.88e+04 Closed loop stable? Yes System: T_N Gain Margin (dB): 635 At frequency (rad/s): 108 Closed loop stable? No

Figure 26: Ts = 0.6 ms, and Ts = 0.1 ms, Both Stable From these examples we can observe that sampling period has a major role to play in deciding the stability of a software based controller.

Magnitude (dB)

10

-2

10

-1

10 Frequency (rad/s)

0

10

1

10

2

10

3

Figure 24: Ts = 0.6 ms, Unstable; Ts = 0.1 ms, Stable

